<!-- Overview View
  The main dashboard display which leads to all other views.
  Content: 4 sections including:
    recent builds
    summaries
    team stats
    metrics by package type
-->

<!-- Recent Builds section -->
<div id='recentBuildsContent' class='contentContainer contentColumnNarrowHalf contentUpperLeft'>
  <h3 class='contentTitle'>Recent Builds</h3>
  <table id='recentBuildsTable' class='table table-striped table-hover'>
    <thead>
      <th class='result'>Result</th>
      <th class='package'>Package</th>
      <th class='dist'>Dist</th>
      <th class='buildTime'><i class="icon-time"></i></th>
      <th id = 'trendHeader'class='trend'><i class="icon-time"></i> Trend by Dist (All Time)</th>
    </thead>
    <tbody>
    <% @stats[:latest].each do |row| %>
      <tr>
        <% if row.success == true
             circleColor = 'limegreen'
           else
             circleColor = 'red'
           end
        %>
        <td>
          <svg id='resultCell'  xmlns="http://www.w3.org/2000/svg" version="1.1">
            <defs>
              <filter id="drop-shadow">
                <feGaussianBlur in="SourceGraphic" stdDeviation="1" />
              </filter>
            </defs>
            <circle class='resultCircle' r='5' cx='20' cy='8' filter="url(#drop-shadow)"
              fill=<%= "#{circleColor}" %>>
          </svg>
        </td>
        <td><%= row.package_name %></td>
        <td><%= row.dist %></td>
        <td><%= "#{row.jenkins_build_time.round(0)} sec" %></td>
        <td id="<%= "sparkline#{row.id}" %>">
          <%= time_array = Array.new
              @trends["#{row.package_name}-#{row.dist}"].each do |row|
                time_array << row.jenkins_build_time
              end
              puts time_array.inspect
          %>
          <script type='text/javascript'>
            createRecentSparkline( <%= time_array %>, <%= "sparkline#{row.id}" %> )
          </script>
        </td>
      </tr>
    <% end %>
    </tbody>
  </table>
</div>

<!-- Team Stats section-->
<div id='teamContent' class='contentContainer contentColumnNarrowHalf contentLowerLeft'>
  <h3 class='contentTitle'>Team Statistics</h3>
</div>

<!-- Summaries section -->
<div id='summaryContent' class='contentContainer contentColumnWideHalf contentUpperRight'>
  <h3 class='contentTitle'>Metric Summaries</h3>
  <div id='summaryBuildNumber'>
      <h4 class='contentTitle'>Builds over Last 12 Weeks</h4>
    <div id='summaryBuildNumberContent'>
      <div id='summaryBuildsYLabel' class='yAxisLabel'>Builds</div>
      <script type='text/javascript'>
        createBuildTimeSeriesGraph(<%= @totalBuildsTimeSeries.to_json %>)
      </script>
      <div id='summaryBuildsXLabel'>Weeks Ago</div>
    </div>
  </div>

  <div id='summaryShipped'>
    <h4 class='contentTitle'>Shipped Packages this Month</h4>
    <div id='summaryShippedContent'>
      <div class='yAxisLabel'>Shipped</div>
      <script type='text/javascript'>
        createShippedGraph(<%= [@stats[:shipped][:final].to_json, @stats[:shipped][:rc].to_json] %>)
      </script>
    </div>
  </div>

  <div id='summaryFreqPackages'>
    <h5 class='summaryHalfChart contentTitle'>Frequently Built Packages</h5>
    <div id='summaryFreqPackagesContent'>
      <table class='table table-striped table-hover freqTable'>
        <thead>
          <th class='freqPkgTableHead'>Package</th>
          <th class='freqPkgTableHead'>Builds</th>
        </thead>
        <tbody>
          <% @freqPackages.each do |pkg| %>
            <tr>
              <td><strong><%= pkg[0] %></strong></td>
              <td><%= pkg[1] %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <div id='summaryFreqUsers'>
    <h5 class='summaryHalfChart contentTitle'>Most Active Users</h5>
    <div id='summaryFreqUsersContent'>
      <table class='table table-striped table-hover freqTable'>
        <thead>
          <th class='freqUsersTableHead'>Username</th>
          <th class='freqUsersTableHead'>Builds</th>
        </thead>
        <tbody>
          <% @freqUsers.each do |user| %>
            <tr>
              <td><strong><%= user[0] %></strong></td>
              <td><%= user[1] %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Metrics by Package Type Section -->
<div id='typeContent' class='contentContainer contentColumnWideHalf contentLowerRight'>
  <h3 class='contentTitle'>Metrics by Package Type</h3>
  <div id='typeBuildNumber'>
      <h4 class='contentTitle'>Number of Builds</h4>
    <div id='typeBuildNumberContent' class='typeChartContent'>
      <div class='yAxisLabel'>Builds</div>
      <script type='text/javascript'>
        createDistNumbersGraph(<%= [@stats[:deb].to_json, @stats[:rpm].to_json, @stats[:gem].to_json, @stats[:dmg].to_json] %>)
      </script>
    </div>
  </div>

  <div id='typeBuildSpeed'>
    <h4 class='contentTitle'>Average Build Speed</h4>
    <div id='typeBuildSpeedContent' class='typeChartContent'>
      <div class='yAxisLabel'>Seconds</div>
      <script type='text/javascript'>
        createDistAvgSpeedGraph(<%= [@stats[:deb].to_json, @stats[:rpm].to_json, @stats[:gem].to_json, @stats[:dmg].to_json] %>)
      </script>
    </div>
  </div>

  <div id='typeBuildHost'>
    <h4 class='contentTitle'>Most Used Build Hosts by Type</h4>
    <div id='typeBuildHostContent' class='typeChartContent'>
      <table id='freqHostTable' class='table table-striped table-hover'>
        <thead>
          <th class='freqHostTableHead'>Type</th>
          <th class='freqHostTableHead'>Host</th>
          <th class='freqHostTableHead'>Builds</th>
          <th id='freqHostPercentRow' class='freqHostTableHead'>Percentage of Builds</th>
        </thead>
        <tbody>
          <% [@stats[:deb], @stats[:rpm], @stats[:gem], @stats[:dmg]].each do |pkgtype| %>
            <tr>
              <td><strong><%= pkgtype[:type] %></strong></td>
              <td><%= pkgtype[:freqHost][0] %></td>
              <td><%= pkgtype[:freqHost][1] %></td>
              <td id='freqHostPercentRow'><%= "#{pkgtype[:freqHostPercent]}%" %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
